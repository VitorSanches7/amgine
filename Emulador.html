<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máquina Enigma - Projeto AMGINE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #2a2a2a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        .enigma-container {
            background: #e8e0d0;
            border: 8px solid #8b7355;
            border-radius: 10px;
            max-width: 600px;
            width: 100%;
            box-shadow: 
                0 0 30px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .enigma-main {
            background: linear-gradient(145deg, #4a4a52, #3a3a42);
            margin: 15px;
            border-radius: 8px;
            padding: 20px;
            box-shadow: inset 3px 3px 8px rgba(0,0,0,0.3);
        }

        .enigma-brand {
            text-align: center;
            margin-bottom: 20px;
        }

        .brand-logo {
            background: #666;
            color: #ddd;
            padding: 8px 25px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 2px;
            display: inline-block;
        }

        .rotor-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            align-items: center;
        }

        .rotor-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rotor-slider {
            width: 20px;
            height: 100px;
            background: linear-gradient(to bottom, #ddd 0%, #999 50%, #ddd 100%);
            border: 2px solid #666;
            border-radius: 10px;
            position: relative;
            margin-bottom: 10px;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.3);
        }

        .rotor-window {
            background: #333;
            color: #fff;
            width: 35px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            border: 2px solid #666;
            border-radius: 3px;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.5);
        }

        .rotor-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-left: 10px;
        }

        .rotor-btn {
            background: linear-gradient(145deg, #888, #666);
            border: 1px solid #555;
            border-radius: 3px;
            width: 25px;
            height: 20px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }

        .rotor-btn:hover {
            background: linear-gradient(145deg, #999, #777);
        }

        .rotor-btn:active {
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.3);
        }

        .selector-knob {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #888 30%, #555 70%);
            border: 3px solid #333;
            border-radius: 50%;
            position: relative;
            margin: 0 20px;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.3);
        }

        .selector-knob::before {
            content: '';
            width: 15px;
            height: 15px;
            background: #222;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .selector-numbers {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .led-panel {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: inset 3px 3px 8px rgba(0,0,0,0.5);
        }

        .led-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
        }

        .led {
            width: 35px;
            height: 35px;
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            font-size: 14px;
            transition: all 0.3s;
            box-shadow: 
                inset 2px 2px 4px rgba(0,0,0,0.8),
                2px 2px 4px rgba(0,0,0,0.3);
        }

        .led.active {
            background: radial-gradient(circle, #ffff88, #ffaa00);
            color: #333;
            border-color: #ffaa00;
            box-shadow: 
                0 0 15px #ffaa00,
                0 0 25px #ffaa00,
                inset 1px 1px 2px rgba(255,255,255,0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .keyboard-section {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: inset 3px 3px 8px rgba(0,0,0,0.5);
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
        }

        .key {
            background: radial-gradient(circle, #ddd 30%, #aaa 70%);
            border: 2px solid #888;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 
                3px 3px 6px rgba(0,0,0,0.3),
                inset 1px 1px 2px rgba(255,255,255,0.3);
        }

        .key:hover {
            background: radial-gradient(circle, #eee 30%, #bbb 70%);
            transform: translateY(-1px);
        }

        .key:active, .key.pressed {
            background: radial-gradient(circle, #999 30%, #666 70%);
            transform: translateY(2px);
            box-shadow: 
                1px 1px 3px rgba(0,0,0,0.5),
                inset 2px 2px 4px rgba(0,0,0,0.3);
        }

        .message-section {
            background: #e8e0d0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #8b7355;
        }

        .message-label {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .message-display {
            background: linear-gradient(45deg, #f4e6d3, #e8dcc0);
            border: 2px inset #8b7355;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            color: #2a2a2a;
            min-height: 30px;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
            word-break: break-all;
            letter-spacing: 2px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(145deg, #666, #444);
            border: 2px solid #333;
            border-radius: 5px;
            padding: 8px 15px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }

        .control-btn:hover {
            background: linear-gradient(145deg, #777, #555);
        }

        .control-btn:active {
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.3);
        }

        .control-btn.clear {
            background: linear-gradient(145deg, #888, #666);
        }

        .status-display {
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
            color: #333;
            font-weight: bold;
        }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 640px) {
            body {
                padding: 10px;
            }
            .enigma-main {
                margin: 10px;
                padding: 15px;
            }
            .led-panel, .keyboard-section {
                padding: 10px;
            }
            .led-row, .keyboard-row {
                gap: 4px;
            }
            .led {
                width: 32px;
                height: 32px;
                font-size: 11px;
            }
            .key {
                width: 35px;
                height: 35px;
                font-size: 12px;
            }
            .rotor-section {
                gap: 10px;
                flex-wrap: wrap;
            }
            .selector-knob {
                width: 70px;
                height: 70px;
            }
            .message-section {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .enigma-main {
                margin: 5px;
                padding: 10px;
            }
            .led-row, .keyboard-row {
                gap: 3px;
            }
            .key {
                width: 28px;
                height: 28px;
                font-size: 10px;
                border-width: 1px;
            }
            .led {
                width: 26px;
                height: 26px;
                font-size: 9px;
                border-width: 1px;
            }
            .rotor-section {
                gap: 5px;
            }
            .rotor-window {
                width: 30px;
                height: 22px;
                font-size: 14px;
            }
            .selector-knob {
                width: 50px;
                height: 50px;
            }
            .control-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            .message-display {
                font-size: 14px;
                letter-spacing: 1px;
            }
        }
    </style>
</head>
<body>
    <div class="enigma-container">
        <div class="enigma-main">
            <div class="enigma-brand">
                <div class="brand-logo">ENIGMA</div>
            </div>
            
            <div class="rotor-section">
                <div class="rotor-container">
                    <div class="rotor-slider"></div>
                    <div class="rotor-window" id="rotor3">A</div>
                </div>
                <div class="rotor-controls">
                    <button class="rotor-btn" onclick="adjustRotor(3, 1)">▲</button>
                    <button class="rotor-btn" onclick="adjustRotor(3, -1)">▼</button>
                </div>
                
                <div class="rotor-container">
                    <div class="rotor-slider"></div>
                    <div class="rotor-window" id="rotor2">A</div>
                </div>
                <div class="rotor-controls">
                    <button class="rotor-btn" onclick="adjustRotor(2, 1)">▲</button>
                    <button class="rotor-btn" onclick="adjustRotor(2, -1)">▼</button>
                </div>
                
                <div class="rotor-container">
                    <div class="rotor-slider"></div>
                    <div class="rotor-window" id="rotor1">A</div>
                </div>
                <div class="rotor-controls">
                    <button class="rotor-btn" onclick="adjustRotor(1, 1)">▲</button>
                    <button class="rotor-btn" onclick="adjustRotor(1, -1)">▼</button>
                </div>

                <div class="selector-knob">
                    <div class="selector-numbers"></div>
                </div>
            </div>

            <div class="led-panel">
                <div class="led-row">
                    <div class="led" id="led-Q">Q</div>
                    <div class="led" id="led-W">W</div>
                    <div class="led" id="led-E">E</div>
                    <div class="led" id="led-R">R</div>
                    <div class="led" id="led-T">T</div>
                    <div class="led" id="led-Z">Z</div>
                    <div class="led" id="led-U">U</div>
                    <div class="led" id="led-I">I</div>
                    <div class="led" id="led-O">O</div>
                </div>
                <div class="led-row">
                    <div class="led" id="led-A">A</div>
                    <div class="led" id="led-S">S</div>
                    <div class="led" id="led-D">D</div>
                    <div class="led" id="led-F">F</div>
                    <div class="led" id="led-G">G</div>
                    <div class="led" id="led-H">H</div>
                    <div class="led" id="led-J">J</div>
                    <div class="led" id="led-K">K</div>
                </div>
                <div class="led-row">
                    <div class="led" id="led-P">P</div>
                    <div class="led" id="led-Y">Y</div>
                    <div class="led" id="led-X">X</div>
                    <div class="led" id="led-C">C</div>
                    <div class="led" id="led-V">V</div>
                    <div class="led" id="led-B">B</div>
                    <div class="led" id="led-N">N</div>
                    <div class="led" id="led-M">M</div>
                    <div class="led" id="led-L">L</div>
                </div>
            </div>

            <div class="keyboard-section">
                <div class="keyboard-row">
                    <div class="key" onclick="processLetter('Q')">Q</div>
                    <div class="key" onclick="processLetter('W')">W</div>
                    <div class="key" onclick="processLetter('E')">E</div>
                    <div class="key" onclick="processLetter('R')">R</div>
                    <div class="key" onclick="processLetter('T')">T</div>
                    <div class="key" onclick="processLetter('Z')">Z</div>
                    <div class="key" onclick="processLetter('U')">U</div>
                    <div class="key" onclick="processLetter('I')">I</div>
                    <div class="key" onclick="processLetter('O')">O</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" onclick="processLetter('A')">A</div>
                    <div class="key" onclick="processLetter('S')">S</div>
                    <div class="key" onclick="processLetter('D')">D</div>
                    <div class="key" onclick="processLetter('F')">F</div>
                    <div class="key" onclick="processLetter('G')">G</div>
                    <div class="key" onclick="processLetter('H')">H</div>
                    <div class="key" onclick="processLetter('J')">J</div>
                    <div class="key" onclick="processLetter('K')">K</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" onclick="processLetter('P')">P</div>
                    <div class="key" onclick="processLetter('Y')">Y</div>
                    <div class="key" onclick="processLetter('X')">X</div>
                    <div class="key" onclick="processLetter('C')">C</div>
                    <div class="key" onclick="processLetter('V')">V</div>
                    <div class="key" onclick="processLetter('B')">B</div>
                    <div class="key" onclick="processLetter('N')">N</div>
                    <div class="key" onclick="processLetter('M')">M</div>
                    <div class="key" onclick="processLetter('L')">L</div>
                </div>
            </div>
        </div>

        <div class="message-section">
            <div class="message-label">Entrada da Mensagem:</div>
            <div class="message-display" id="input-display"></div>
            
            <div class="message-label" style="margin-top: 15px;">Saída da Mensagem:</div>
            <div class="message-display" id="output-display"></div>
        </div>

        <div class="controls">
            <button class="control-btn clear" onclick="clearDisplay()">LIMPAR</button>
            <button class="control-btn" onclick="resetRotors()">RESET</button>
        </div>

        <div class="status-display">
            <div>ROTORES: <span id="rotor-status">A A A</span></div>
        </div>
    </div>

    <script>
        // Configuração inicial baseada no código Arduino
        const alphaValues = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 
                            'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

        // Layout do teclado conforme a imagem
        const keyboardLayout = [
            ['Q', 'W', 'E', 'R', 'T', 'Z', 'U', 'I', 'O'],
            ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K'],
            ['P', 'Y', 'X', 'C', 'V', 'B', 'N', 'M', 'L']
        ];

        // Configurações dos rotores (exatamente como no Arduino)
        let vogaisPosicao = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25];
        let vogaisTrocada1 = [5, 20, 19, 8, 7, 0, 21, 4, 3, 23, 11, 10, 25, 24, 15, 14, 22, 18, 17, 2, 1, 6, 16, 9, 13, 12];
        let vogaisTrocada2 = [20, 8, 11, 18, 12, 22, 23, 21, 1, 24, 17, 2, 4, 15, 25, 13, 19, 10, 3, 16, 0, 7, 5, 6, 9, 14];
        let vogaisTrocada3 = [9, 2, 1, 17, 22, 24, 16, 21, 15, 0, 23, 20, 14, 19, 12, 8, 6, 3, 25, 13, 11, 7, 4, 10, 5, 18];
        let vogaisTrocadaRefletor = [9, 11, 8, 22, 14, 7, 21, 5, 2, 0, 20, 1, 17, 16, 4, 25, 13, 12, 23, 24, 10, 6, 3, 18, 19, 15];

        // Posições dos rotores
        let rotor1Posicao = 0;
        let rotor2Posicao = 0;
        let rotor3Posicao = 0;

        // Controle de mensagens
        let inputMessage = '';
        let outputMessage = '';

        // Funções de rotação dos arrays (igual ao Arduino)
        function rotacionaArray(arr) {
            const temp = arr[0];
            for (let i = 0; i < arr.length - 1; i++) {
                arr[i] = arr[i + 1];
            }
            arr[arr.length - 1] = temp;
        }

        function rotacionaArrayInverso(arr) {
            const temp = arr[arr.length - 1];
            for (let i = arr.length - 1; i > 0; i--) {
                arr[i] = arr[i - 1];
            }
            arr[0] = temp;
        }

        // Inicialização da interface
        function initializeInterface() {
            updateDisplay();
        }

        // Processamento da letra (lógica principal do Arduino)
        function processLetter(letra) {
            // Encontrar posição inicial da letra
            const posInicial = alphaValues.indexOf(letra);
            if (posInicial === -1) return;

            // Adicionar letra à mensagem de entrada
            inputMessage += letra;
            document.getElementById('input-display').textContent = inputMessage;

            // Codificação passando pelos rotores (ida)
            let posTrocada1 = vogaisTrocada1[posInicial];
            let posTrocada2 = vogaisTrocada2[posTrocada1];
            let posTrocada3 = vogaisTrocada3[posTrocada2];
            let posTrocadaRefletor = vogaisTrocadaRefletor[posTrocada3];

            // Codificação passando pelos rotores (volta)
            // Rotor 3
            for (let i = 0; i < 26; i++) {
                if (vogaisTrocada3[i] === posTrocadaRefletor) {
                    posTrocada3 = i;
                    break;
                }
            }

            // Rotor 2
            for (let i = 0; i < 26; i++) {
                if (vogaisTrocada2[i] === posTrocada3) {
                    posTrocada2 = i;
                    break;
                }
            }

            // Rotor 1
            for (let i = 0; i < 26; i++) {
                if (vogaisTrocada1[i] === posTrocada2) {
                    posTrocada1 = i;
                    break;
                }
            }

            const letraFinal = alphaValues[posTrocada1];

            // Adicionar letra cifrada à saída
            outputMessage += letraFinal;
            document.getElementById('output-display').textContent = outputMessage;

            // Acender LED correspondente
            lightLED(letraFinal);

            // Animação da tecla pressionada
            animateKeyPress(letra);

            // Rotação automática dos rotores após processamento
            rotateRotorsAfterInput();

            // Atualizar display dos rotores
            updateRotorDisplay();
        }

        // Rotação automática dos rotores (lógica do Arduino)
        function rotateRotorsAfterInput() {
            if (rotor1Posicao < 25) {
                rotacionaArray(vogaisTrocada1);
                rotor1Posicao++;
            } else {
                rotor1Posicao = 0;
                rotacionaArray(vogaisTrocada1);
                rotacionaArray(vogaisTrocada2);
                rotor2Posicao++;

                if (rotor2Posicao === 26) {
                    rotor2Posicao = 0;
                    rotacionaArray(vogaisTrocada1);
                    rotacionaArray(vogaisTrocada2);
                    rotacionaArray(vogaisTrocada3);
                    rotor3Posicao++;
                    
                    if (rotor3Posicao === 26) {
                        rotor3Posicao = 0;
                    }
                }
            }
        }

        // Ajuste manual dos rotores
        function adjustRotor(rotorNum, direction) {
            if (rotorNum === 1) {
                if (direction === 1) {
                    rotor1Posicao = (rotor1Posicao + 1) % 26;
                    rotacionaArray(vogaisTrocada1);
                } else {
                    rotor1Posicao = (rotor1Posicao - 1 + 26) % 26;
                    rotacionaArrayInverso(vogaisTrocada1);
                }
            } else if (rotorNum === 2) {
                if (direction === 1) {
                    rotor2Posicao = (rotor2Posicao + 1) % 26;
                    rotacionaArray(vogaisTrocada2);
                } else {
                    rotor2Posicao = (rotor2Posicao - 1 + 26) % 26;
                    rotacionaArrayInverso(vogaisTrocada2);
                }
            } else if (rotorNum === 3) {
                if (direction === 1) {
                    rotor3Posicao = (rotor3Posicao + 1) % 26;
                    rotacionaArray(vogaisTrocada3);
                } else {
                    rotor3Posicao = (rotor3Posicao - 1 + 26) % 26;
                    rotacionaArrayInverso(vogaisTrocada3);
                }
            }
            updateRotorDisplay();
        }

        function updateRotorDisplay() {
            document.getElementById('rotor1').textContent = alphaValues[rotor1Posicao];
            document.getElementById('rotor2').textContent = alphaValues[rotor2Posicao];
            document.getElementById('rotor3').textContent = alphaValues[rotor3Posicao];
            document.getElementById('rotor-status').textContent = 
                `${alphaValues[rotor3Posicao]} ${alphaValues[rotor2Posicao]} ${alphaValues[rotor1Posicao]}`;
        }

        function lightLED(letra) {
            // Desligar todos os LEDs
            document.querySelectorAll('.led').forEach(led => led.classList.remove('active'));
            
            // Acender LED da letra cifrada
            const targetLED = document.getElementById(`led-${letra}`);
            if (targetLED) {
                targetLED.classList.add('active');
                
                // Desligar após 1 segundo
                setTimeout(() => {
                    targetLED.classList.remove('active');
                }, 1000);
            }
        }

        function animateKeyPress(letra) {
            const keys = document.querySelectorAll('.key');
            keys.forEach(key => {
                if (key.textContent === letra) {
                    key.classList.add('pressed');
                    setTimeout(() => {
                        key.classList.remove('pressed');
                    }, 200);
                }
            });
        }

        function clearDisplay() {
            inputMessage = '';
            outputMessage = '';
            document.getElementById('input-display').textContent = '';
            document.getElementById('output-display').textContent = '';
            
            // Desligar todos os LEDs
            document.querySelectorAll('.led').forEach(led => led.classList.remove('active'));
        }

        function resetRotors() {
            // Resetar arrays para configuração inicial
            vogaisTrocada1 = [5, 20, 19, 8, 7, 0, 21, 4, 3, 23, 11, 10, 25, 24, 15, 14, 22, 18, 17, 2, 1, 6, 16, 9, 13, 12];
            vogaisTrocada2 = [20, 8, 11, 18, 12, 22, 23, 21, 1, 24, 17, 2, 4, 15, 25, 13, 19, 10, 3, 16, 0, 7, 5, 6, 9, 14];
            vogaisTrocada3 = [9, 2, 1, 17, 22, 24, 16, 21, 15, 0, 23, 20, 14, 19, 12, 8, 6, 3, 25, 13, 11, 7, 4, 10, 5, 18];
            
            // Resetar posições
            rotor1Posicao = 0;
            rotor2Posicao = 0;
            rotor3Posicao = 0;
            
            updateRotorDisplay();
            clearDisplay();
        }

        function updateDisplay() {
            updateRotorDisplay();
            clearDisplay();
        }

        // Suporte para teclado físico
        document.addEventListener('keydown', function(event) {
            const letra = event.key.toUpperCase();
            if (alphaValues.includes(letra)) {
                processLetter(letra);
            }
        });

        // --- Suporte para Toque em Dispositivos Móveis ---
        function initializeTouchSupport() {
            // Seleciona todos os elementos clicáveis
            const tappableElements = document.querySelectorAll('.key, .rotor-btn, .control-btn');

            tappableElements.forEach(element => {
                // Adiciona um listener para o evento 'touchstart'
                element.addEventListener('touchstart', function(event) {
                    // Previne o comportamento padrão do toque (como zoom ou rolagem)
                    event.preventDefault();
                    // Dispara o evento de clique, que executará a função do atributo 'onclick'
                    element.click();
                }, { passive: false });
            });
        }

        // Inicializar quando a página carregar
        window.onload = function() {
            initializeInterface();
            initializeTouchSupport(); // Adiciona o suporte ao toque
        };
    </script>
</body>
</html>